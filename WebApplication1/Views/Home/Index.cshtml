@*WE LOAD AN EMPTY VIEW THEN IT GETS FILLED USING JQUERY AJAX*@
@model WebApplication1.Models.ViewModels.DashboardViewModel

<style>
    .dashboard-holder {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
    }

    .dashboard-right-side {
        display: flex;
        flex-direction: column;
        justify-content: center;
        border-left: 1px solid #e6e6e6;
        max-width: 280px;
        min-width: 280px;
        padding-left: 3%;
    }

    .dashboard-left-side {
        display: flex;
        flex-direction: column;
        justify-content: center;
        /*border: 1px solid black;*/
    }

    .dashboard-item-container {
        text-align: center;
        font-size: 25px;
        border: 1px solid #e6e6e6;
        border-radius: 5px;
        padding: 5%;
        margin: 3%;
    }

        .dashboard-item-container i {
            font-size: 250%;
        }


        #coming-elections-area .spinner-border{
            display:none;
        }
        #coming-elections-area .table{
            display:none;
        }
</style>


<br />
<h1 class="margins text-center">Welcome to Voting App</h1>
<hr />
<br />
<div class="dashboard-holder">
    <div class="dashboard-left-side">
        <div id="current-election-area">

        </div>
        <div id="coming-elections-area">      
            <h2 class="text-center">Future Elections</h2>
            <div class="spinner-border">

            </div>
            <table class="table">
                <thead>
                    <tr>
                        <th>
                            Name
                        </th>
                        <th>
                            StartDate
                        </th>
                        <th>
                            Duration (days)
                        </th>
                        <th>
                            Number of Candidates
                        </th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
        <div id="previous-elections-area">

        </div>
    </div>
    <div class="dashboard-right-side">
        <h2 class="text-center">Statistics</h2>
        <hr />
        <div class="dashboard-item-container">
            <i class="fa fa-university" aria-hidden="true"></i>
            <p>@Model.NbElections Elections</p>
        </div>
        <div class="dashboard-item-container">
            <i class="fa fa-id-card-o" aria-hidden="true"></i>
            <p>@Model.NbCandidates Candidates</p>
        </div>
        <div class="dashboard-item-container">
            <i class="fa fa-users" aria-hidden="true"></i>
            <p>@Model.NbVoters Voters</p>
        </div>
        <div class="dashboard-item-container">
            <i class="fa fa-envelope" aria-hidden="true"></i>
            <p>@Model.NbVotes Votes</p>
        </div>
    </div>
</div>







<script>
    //Start loading things once the page is ready
    document.addEventListener("DOMContentLoaded", loadElectionsData);



    function loadElectionsData() {
        //1- Load Coming Elections, hide table and display spinner
        let comingElectionsArea = document.getElementById("coming-elections-area");
        displayElement(comingElectionsArea.querySelector(".spinner-border"));
        hideElement(comingElectionsArea.querySelector(".table"));
        loadComingElections();
        //2- Load Previous Elections

        //3- Load Current Election
    }




    function loadComingElections() {
        //this function load a list of coming elections using jQuery ajax
        //console.log("trying to load data of " + JSON.stringify(electionId));
    //get the list of candidates using the id of the election
    $.ajax({
        type: "POST",
        url: "/Election/GetComingElections",
        /*data: JSON.stringify(document.getElementById("candidate-id-holder").value),*/
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        error: function () {
            alert("error");
        },
        success: function (response) {
            //'response' represents the object returned from the api which is the Election object newly stored in the db
            console.log(response);
            //console.log(response.length);
            displayComingElections(response);

            //window.location.href = "Home/Index";
        }
    });
    
    }
    function displayComingElections(comingElections) {
        let comingElectionsArea = document.getElementById("coming-elections-area");
        let table = comingElectionsArea.querySelector(".table");

        let tableBody = table.querySelector("tbody");

        for (let i = 0; i < comingElections.length; i++) {

            let tdName = document.createElement("td");
            tdName.innerText = comingElections[i].Name;
            
            let tdStartDate = document.createElement("td");
            tdStartDate.innerText = comingElections[i].StartDate;
            
            let tdDurationInDays = document.createElement("td");
            tdDurationInDays.innerText = comingElections[i].DurationInDays;

            let tdCandidatesCount = document.createElement("td");
            tdCandidatesCount.innerText = comingElections[i].Count;

            let electionRow = document.createElement("tr");
            electionRow.appendChild(tdName);
            electionRow.appendChild(tdStartDate);
            electionRow.appendChild(tdDurationInDays);
            electionRow.appendChild(tdCandidatesCount);

            tableBody.appendChild(electionRow);
        }


        //now lets display the tabl and hide the spinner                
        hideElement(comingElectionsArea.querySelector(".spinner-border"));
        displayElement(table);
    }
    function displayElement(elt) {
        //this function displays an element
        elt.style.display = "block";
    }
    function hideElement(elt) {
        //this function hides an element
        elt.style.display = "none";
    }
</script>




























<!--


    THIS IS THE OLD DASHBOARD USED BEFORE INTRODUCING THE ELECTION NOTION




    @*@model WebApplication1.Models.ViewModels.DashboardViewModel
@{
    ViewData["Title"] = "Home Page";
}*@


@*LETS LOAD THE CSS OF THE DASHBOARD*@
<partial name="_dashboardStyle"/>
<h1 class="margins">Welcome to Voting App</h1>
<hr />

    @*@if (!@Model.UserHasVoted)
    {
        <div id="vote-button-container">
            <a class="btn btn-default" asp-controller="Vote" asp-action="Index" asp-route-currentElectionId="@Model.CurrentElectionId" title="Go Vote">
                Vote <i class="fa fa-chevron-right" aria-hidden="true"></i>
            </a>
        </div>
    }
    else
    {
        int i = 0;
        <div id="results-container" class="margins">
            <h3 class="margins">Updated Results</h3>

            @foreach (var candidate in Model.Candidates)
            {
                i++;
                //so it is the first candidate, lets add the cup icon to it
                <div class="one-result-container">
                    <div class="rank-container">
                        @if (i == 1)
                        {
                            <span><i class="fa fa-trophy" aria-hidden="true"></i></span>
                        }
                        else
                        {
                            <span>@i.ToString()</span>
                        }

                    </div>
                    <div class="candidate-data-container">
                        <p>@candidate.FirstName @candidate.LastName</p>
                        <p>@candidate.VotesCount Votes</p>
                    </div>
                </div>
            }
        </div>
    }*@



<div id="dashboard-container" class="margins">
    <div class="dashboard-item-container">
        <i class="fa fa-user" aria-hidden="true"></i>
        <p>@*@Model.NbCandidates Candidates*@</p>
    </div>
    <div class="dashboard-item-container">
        <i class="fa fa-users" aria-hidden="true"></i>
        <p>@*@Model.NbVoters Voters*@</p>
    </div>
    <div class="dashboard-item-container">
        <i class="fa fa-envelope" aria-hidden="true"></i>
        <p>@*@Model.NbVotes Votes*@</p>
    </div>
    <div class="dashboard-item-container">
        <i class="fa fa-pie-chart" aria-hidden="true"></i>
        <p>@*@Model.ParticipationRate.ToString("F2") %*@</p>
    </div>
</div>
-->
